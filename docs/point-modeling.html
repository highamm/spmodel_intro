<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.353">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Introduction to Spatial Modeling with spmodel - 3&nbsp; Modeling Point Data</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./model-assumptions.html" rel="next">
<link href="./spatial-covariance.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./data-exploration.html">Spatial Modeling with <code>spmodel</code></a></li><li class="breadcrumb-item"><a href="./point-modeling.html"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Modeling Point Data</span></a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Introduction to Spatial Modeling with spmodel</a> 
        <div class="sidebar-tools-main">
  <a href="" class="quarto-reader-toggle quarto-navigation-tool px-1" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
 <span class="menu-text">Spatial Modeling with <code>spmodel</code></span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./data-exploration.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Spatial Data Exploration</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./spatial-covariance.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Spatial Covariance and Correlation</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./point-modeling.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Modeling Point Data</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./model-assumptions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Model Assumptions</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./prediction.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Prediction</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./logistic-modeling.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Spatial Logistic Regression</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./areal-modeling.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Areal Modeling</span></span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#motivation" id="toc-motivation" class="nav-link active" data-scroll-target="#motivation"><span class="header-section-number">3.1</span> Motivation</a></li>
  <li><a href="#fitting-a-model" id="toc-fitting-a-model" class="nav-link" data-scroll-target="#fitting-a-model"><span class="header-section-number">3.2</span> Fitting a Model</a></li>
  <li><a href="#review-of-the-independent-error-model" id="toc-review-of-the-independent-error-model" class="nav-link" data-scroll-target="#review-of-the-independent-error-model"><span class="header-section-number">3.3</span> Review of the Independent Error Model</a></li>
  <li><a href="#the-spatial-linear-model" id="toc-the-spatial-linear-model" class="nav-link" data-scroll-target="#the-spatial-linear-model"><span class="header-section-number">3.4</span> The Spatial Linear Model</a></li>
  <li><a href="#interpreting-the-spatial-linear-model" id="toc-interpreting-the-spatial-linear-model" class="nav-link" data-scroll-target="#interpreting-the-spatial-linear-model"><span class="header-section-number">3.5</span> Interpreting the Spatial Linear Model</a>
  <ul class="collapse">
  <li><a href="#inference" id="toc-inference" class="nav-link" data-scroll-target="#inference"><span class="header-section-number">3.5.1</span> Inference</a></li>
  </ul></li>
  <li><a href="#sec-compare" id="toc-sec-compare" class="nav-link" data-scroll-target="#sec-compare"><span class="header-section-number">3.6</span> Comparing Models</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span id="sec-point-modeling" class="quarto-section-identifier"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Modeling Point Data</span></span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Goals
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li>Write out the spatial linear model with correlated random errors.</li>
<li>Using <code>spmodel</code>’s <code>splm()</code> function, fit a spatial model to a data set. Using the fitted model, obtain and interpret:
<ul>
<li>a summary table of model output, obtained with <code>tidy()</code>.</li>
<li>a summary table of covariance parameter estimates, obtained with <code>tidy()</code>.</li>
<li>model fit statistics, obtained with <code>glance()</code> and <code>glances()</code>.</li>
<li>fitted values and residuals, obtained with <code>augment()</code>.</li>
</ul></li>
</ul>
</div>
</div>
<p>Throughout this section, we will use the <code>spmodel</code>, <code>sf</code>, <code>tidyverse</code>, and <code>broom</code> packages:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(spmodel)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(broom)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">theme_set</span>(<span class="fu">theme_minimal</span>()) <span class="do">## set the default theme</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The purpose of this section is to introduce the spatial linear model for data collected at point locations in space. We begin by fitting a model to the <code>caribou</code> data set in the <code>spmodel</code> package. After we fit such a model with the <code>spmodel</code> package, we more formally discuss the difference between fitting a spatial model and fitting a model with only independent random errors. We then discuss the interpretation of model coefficients, interpretation of spatial covariance parameters, and the interpretation of model fit statistics like AIC.</p>
<section id="motivation" class="level2" data-number="3.1">
<h2 data-number="3.1" class="anchored" data-anchor-id="motivation"><span class="header-section-number">3.1</span> Motivation</h2>
<p>The <code>caribou</code> data set contains <strong>30</strong> observations from a caribou forage experiment in Alaska. The data, provided by Elizabeth Lenart of the Alaska Department of Fish and Game, is loaded with the <code>spmodel</code> package:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>caribou</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="do">## # A tibble: 30 × 5</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="do">##   water tarp      z     x     y</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="do">##   &lt;fct&gt; &lt;fct&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="do">## 1 Y     clear  2.42     1     6</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="do">## 2 Y     shade  2.44     2     6</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="do">## 3 Y     none   1.81     3     6</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="do">## 4 N     clear  1.97     4     6</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="do">## 5 N     shade  2.38     5     6</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a><span class="do">## 6 Y     none   2.22     1     5</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a><span class="do">## # ℹ 24 more rows</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The <code>caribou</code> data frame contains the following variables, each collected at a point location in space:</p>
<ul>
<li><code>z</code>, the percentage of nitrogen (the response variable for this example)</li>
<li><code>x</code>, the spatial x-coordinate</li>
<li><code>y</code>, the spatial y-coordinate</li>
<li><code>water</code>, a factor with levels <code>N</code> for no water added and <code>Y</code> for water added</li>
<li><code>tarp</code>, a factor with levels <code>clear</code> for a clear tarp, <code>none</code> for no tarp, and <code>shade</code> for a shade tarp</li>
</ul>
<p>Note that <code>caribou</code> is not an <code>sf</code> object so there is no <code>geometry</code> column. Therefore, we will have to provide the <code>x</code> and <code>y</code> coordinates explicitly when we fit a spatial model or make a plot.</p>
<p>Our analysis goal is to assess whether or not <code>water</code> was added and/or the type of <code>tarp</code> cover added are associated with the percentage of nitrogen measured at the location (<code>z</code>). Before we fit any models, we provide a few quick plots of our data:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> caribou, <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y)) <span class="sc">+</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">colour =</span> z)) <span class="sc">+</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_colour_viridis_c</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="point-modeling_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>We might also construct plots exploring the relationships between <code>water</code> and <code>z</code> as well as <code>nitrogen</code> and <code>z</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> caribou, <span class="fu">aes</span>(<span class="at">x =</span> water, <span class="at">y =</span> z)) <span class="sc">+</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="point-modeling_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> caribou, <span class="fu">aes</span>(<span class="at">x =</span> tarp, <span class="at">y =</span> z)) <span class="sc">+</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>() </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="point-modeling_files/figure-html/unnamed-chunk-5-2.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>From these plots, we see that there is some evidence that <code>tarp</code> is associated with nitrogen, as observations with a <code>shade</code> <code>tarp</code> tend to have larger <code>z</code> values than observations with <code>clear</code> and <code>none</code>.</p>
<p>We will fit a spatial linear model with the <code>spmodel</code> package, exploring a few options and interpreting various parameter estimates.</p>
</section>
<section id="fitting-a-model" class="level2" data-number="3.2">
<h2 data-number="3.2" class="anchored" data-anchor-id="fitting-a-model"><span class="header-section-number">3.2</span> Fitting a Model</h2>
<p>Suppose that we want to fit a model to this data set with <code>z</code> as the response variable and <code>tarp</code> and <code>shade</code> as predictors. We can fit such a model with standard linear regression (assuming independence), or, we can fit a spatial linear model that allows for locations closer in space to have random errors that are positively correlated.</p>
<p>To fit and summarise a model with independent random errors, we can use <code>lm()</code> and then obtain a tidy summary table of output with <code>tidy()</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>mod_lm <span class="ot">&lt;-</span> <span class="fu">lm</span>(z <span class="sc">~</span> water <span class="sc">+</span> tarp, <span class="at">data =</span> caribou)</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="fu">tidy</span>(mod_lm)</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="do">## # A tibble: 4 × 5</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="do">##   term        estimate std.error statistic  p.value</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="do">##   &lt;chr&gt;          &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a><span class="do">## 1 (Intercept)   1.96      0.0696    28.2   5.27e-21</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a><span class="do">## 2 waterY       -0.0352    0.0696    -0.506 6.17e- 1</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a><span class="do">## 3 tarpnone      0.0497    0.0853     0.583 5.65e- 1</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a><span class="do">## 4 tarpshade     0.251     0.0853     2.94  6.76e- 3</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The output here should look familiar: we see coefficient estimates in the first column, standard errors in the second, and p-values for hypothesis tests that test whether each of the <span class="math inline">\(\beta\)</span> parameters in the model are different from 0 in the last column. This model assumes that the random error terms are all independent of one another.</p>
<p>To fit and summarise a model with spatially correlated random errors, we can use <code>splm()</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>mod_splm <span class="ot">&lt;-</span> <span class="fu">splm</span>(z <span class="sc">~</span> water <span class="sc">+</span> tarp, <span class="at">data =</span> caribou,</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>                 <span class="at">xcoord =</span> x, <span class="at">ycoord =</span> y, <span class="at">spcov_type =</span> <span class="st">"exponential"</span>)</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="fu">tidy</span>(mod_splm)</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="do">## # A tibble: 4 × 5</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="do">##   term        estimate std.error statistic  p.value</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="do">##   &lt;chr&gt;          &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="do">## 1 (Intercept)   2.05      0.311       6.59 4.33e-11</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="do">## 2 waterY       -0.0831    0.0645     -1.29 1.98e- 1</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a><span class="do">## 3 tarpnone      0.0801    0.0776      1.03 3.02e- 1</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a><span class="do">## 4 tarpshade     0.287     0.0767      3.74 1.86e- 4</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Note that there are three additional arguments to <code>splm()</code> that are not needed with <code>lm()</code>: the <code>xcoord</code> argument, the <code>ycoord</code> argument, and the <code>spcov_type</code> argument. The <code>xcoord</code> and <code>ycoord</code> arguments need to be specified because we need to tell <code>splm()</code> the columns that have the spatial coordinates (these can be left out if <code>data</code> is an <code>sf</code> object, which stores the coordinate information automatically in the <code>geometry</code> column). The <code>spcov_type</code> tells <code>splm()</code> which spatial covariance/correlation function we would like to use to model covariance on the errors.</p>
<p>Comparing the table of summary output for the independent error model and the spatial model, we see that most of the estimates, standard errors, and p-values are similar. (This is not always the case! Sometimes adding a spatial structure to the random errors yields very different estimates for the <span class="math inline">\(\beta\)</span> coefficients in the model). But, how can we interpret the results from the spatial model? How does the theoretical underpinning of the spatial model differ from that of the independent error model? And, which model is a better fit to the <code>caribou</code> data?</p>
</section>
<section id="review-of-the-independent-error-model" class="level2" data-number="3.3">
<h2 data-number="3.3" class="anchored" data-anchor-id="review-of-the-independent-error-model"><span class="header-section-number">3.3</span> Review of the Independent Error Model</h2>
<p>Before discussing the theoretical underpinning of the spatial linear model, we first briefly review the linear model with independent random errors. Recall that a linear model with independent errors for the response <code>z</code> with <code>tarp</code> and <code>water</code> as predictors is</p>
<p><span id="eq-lm"><span class="math display">\[
Y_i = \beta_0 + \beta_1 tarpnone_i + \beta_2 tarpshade_i + \beta_3 water_i + \epsilon_i,
\tag{3.1}\]</span></span></p>
<p>where <span class="math inline">\(i\)</span> goes from <span class="math inline">\(1, 2, \ldots, n\)</span>, <span class="math inline">\(n\)</span> is the total number of observations in the sample, <span class="math inline">\(Y_i\)</span> is the random variable for the percent nitrogen of the <span class="math inline">\(i^{th}\)</span> observation. The terms <span class="math inline">\(tarpnone_i\)</span>, <span class="math inline">\(tarpshade_i\)</span>, and <span class="math inline">\(water_i\)</span> are indicator variables that take on a 1 if observation <span class="math inline">\(i\)</span> has no tarp, a 1 if observation <span class="math inline">\(i\)</span> has a shaded tarp, and a 1 if observation <span class="math inline">\(i\)</span> has water added, respectively. Importantly, for the independent error model, <span class="math inline">\(\epsilon_i\)</span>, the random error for the <span class="math inline">\(i^{th}\)</span> observation, has mean <code>0</code>, constant variance <span class="math inline">\(\sigma_{ie}^2\)</span>, and is independent of all other <span class="math inline">\(\epsilon_j\)</span>. The independence of <span class="math inline">\(\epsilon_i\)</span> and <span class="math inline">\(\epsilon_j\)</span> implies that <span class="math inline">\(\text{Cov}(\epsilon_i, \epsilon_j) = 0\)</span> for all <span class="math inline">\(i \neq j\)</span>.</p>
<p>The model for <span class="math inline">\(Y_i\)</span> consists of two overarching components: a structure for the <strong>mean</strong> and a structure for the <strong>error</strong>.</p>
<p>The <strong>mean</strong> structure is the part of the model with all of the <span class="math inline">\(\beta_j\)</span> coefficients: <span class="math inline">\(\beta_0 + \beta_1 tarpnone_i + \beta_2 tarpshade_i + \beta_3 water_i\)</span>. This part of the structure allows <span class="math inline">\(Y_i\)</span> to have a mean that depends on its predictor values for tarp and water. The <strong>error</strong> structure of the model is the part of the model with <span class="math inline">\(\epsilon_i\)</span>. When we expand this model into a model that allows for spatial covariance, we will largely leave the mean structure untouched and will only modify the error structure to incorporate spatial covariance.</p>
<p>A model with independent errors needs to estimate <strong>5</strong> total parameters: <span class="math inline">\(\beta_0\)</span>, the intercept, <span class="math inline">\(\beta_1\)</span>, <span class="math inline">\(\beta_2\)</span>, and <span class="math inline">\(\beta_3\)</span>, the slope parameters, and <span class="math inline">\(\sigma_{ie}^2\)</span>, the independent error variance parameter.</p>
<p>We can again use the <code>lm()</code> function to fit and obtain a tidy summary of such a model with the <code>caribou</code> data with</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>mod_lm <span class="ot">&lt;-</span> <span class="fu">lm</span>(z <span class="sc">~</span> water <span class="sc">+</span> tarp, <span class="at">data =</span> caribou)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="fu">tidy</span>(mod_lm)</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="do">## # A tibble: 4 × 5</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="do">##   term        estimate std.error statistic  p.value</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="do">##   &lt;chr&gt;          &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a><span class="do">## 1 (Intercept)   1.96      0.0696    28.2   5.27e-21</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a><span class="do">## 2 waterY       -0.0352    0.0696    -0.506 6.17e- 1</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a><span class="do">## 3 tarpnone      0.0497    0.0853     0.583 5.65e- 1</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a><span class="do">## 4 tarpshade     0.251     0.0853     2.94  6.76e- 3</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The five parameter estimates are <span class="math inline">\(\hat{\beta}_0\)</span> = 1.96, <span class="math inline">\(\hat{\beta}_1\)</span> = -0.035, <span class="math inline">\(\hat{\beta}_2\)</span> = 0.05, <span class="math inline">\(\hat{\beta}_3\)</span> = 0.251, and <span class="math inline">\(\hat{\sigma}^2_{ie}\)</span> = 0.036.</p>
<p>However, we might expect that, after accounting for the effects of <code>tarp</code> and <code>water</code>, there may be some spatial correlation in the random errors. That is, the assumption that <span class="math inline">\(\epsilon_i\)</span> is independent of all other <span class="math inline">\(\epsilon_j\)</span> may be unrealistic. We will compare this independent error model with a spatial model later on in <a href="#sec-compare"><span>Section&nbsp;3.6</span></a>.</p>
</section>
<section id="the-spatial-linear-model" class="level2" data-number="3.4">
<h2 data-number="3.4" class="anchored" data-anchor-id="the-spatial-linear-model"><span class="header-section-number">3.4</span> The Spatial Linear Model</h2>
<p>A spatial model extends the standard simple linear regression model with a correlated random error term:</p>
<p><span id="eq-splm"><span class="math display">\[
Y_i = \beta_0 + \beta_1 tarpnone_i + \beta_2 tarpshade_i + \beta_3 water_i + \epsilon_i + \tau_i,
\tag{3.2}\]</span></span></p>
<p>where <span class="math inline">\(\epsilon_i\)</span> is normally distributed with mean <code>0</code>, variance <span class="math inline">\(\sigma^2_{ie}\)</span>, and <span class="math inline">\(\epsilon_i\)</span> is independent of <span class="math inline">\(\epsilon_j\)</span> for all <span class="math inline">\(i \neq j\)</span>. Note that <a href="model-assumptions.html#eq-splm">Equation&nbsp;<span>4.1</span></a> is identical to <a href="#eq-lm">Equation&nbsp;<span>3.1</span></a> except for the very last term <span class="math inline">\(\tau_i\)</span>: we add this term in to slightly modify the <strong>error structure</strong> of the model while leaving the mean structure as is. This other random error term, <span class="math inline">\(\tau_i\)</span>, is normally distributed with mean <code>0</code>, variance <span class="math inline">\(\sigma^2_{de}\)</span>, but can have covariance with <span class="math inline">\(\tau_j\)</span>. So, while <span class="math inline">\(\epsilon_i\)</span> represents <em>independent random error</em>, <span class="math inline">\(\tau_i\)</span> represents spatailly <em>dependent random error</em>. We then model the covariance of <span class="math inline">\(\tau_i\)</span> and <span class="math inline">\(\tau_j\)</span> using a covariance model discussed in <a href="spatial-covariance.html"><span>Chapter&nbsp;2</span></a>. For example, we might use the <code>"exponential"</code> covariance model to model the covariance between <span class="math inline">\(\tau_i\)</span> and <span class="math inline">\(\tau_j\)</span>:</p>
<p><span class="math display">\[\begin{equation}
\text{cov}(\tau_i, \tau_j) = \sigma^2_{de} \text{exp}(\frac{-h_{ij}}{\phi}),
\end{equation}\]</span></p>
<p>where <span class="math inline">\(h_{ij}\)</span> is the Euclidian distance between the observations at locations <span class="math inline">\(i\)</span> and <span class="math inline">\(j\)</span>, and <span class="math inline">\(\phi\)</span> is called the <strong>range</strong> parameter, which controls the rate of decay of the covariance as a function of distance.</p>
<p>Therefore, with this model, if we assume that all <span class="math inline">\(\epsilon_i\)</span> are independent of all <span class="math inline">\(\tau_i\)</span>, we have that:</p>
<p><span class="math display">\[
\text{cov}(Y_i, Y_j) = \text{cov}(\epsilon_i, \epsilon_j) + \text{cov}(\tau_i, \tau_j) =
\begin{cases}
\sigma_{ie}^2 + \sigma_{de}^2 e^{\frac{-h_{ij}}{\phi}}, &amp; h_{ij} = 0\\
\sigma_{de}^2 e^{\frac{-h_{ij}}{\phi}}, &amp; h_{ij} &gt; 0
\end{cases}
\]</span></p>
<p>This is the same model that we used at the end of <a href="spatial-covariance.html"><span>Chapter&nbsp;2</span></a>: we are now just using this model on the random errors of a linear regression model and allowing the <span class="math inline">\(Y_i\)</span>’s to have different means that depend on the mean structure of the model.</p>
<p>A spatial model with the exponential covariance function estimates <strong>7</strong> total parameters:</p>
<ul>
<li><span class="math inline">\(\beta_0\)</span>, the intercept, and <span class="math inline">\(\beta_1\)</span>, <span class="math inline">\(\beta_2\)</span>, and <span class="math inline">\(\beta_3\)</span>, the slope parameters</li>
<li><span class="math inline">\(\sigma_{ie}^2\)</span>, the independent variance parameter, <span class="math inline">\(\sigma^2_{de}\)</span>, the spatially dependent variance parameter, and <span class="math inline">\(\phi\)</span>, the range parameter.</li>
</ul>
<p>Recall that, in the spatial model, <span class="math inline">\(\sigma_{ie}^2\)</span> is sometimes referred to as the <strong>nugget</strong>, <span class="math inline">\(\sigma^2_{de}\)</span> is sometimes referred to as the <strong>partial sill</strong>, and <span class="math inline">\(\phi\)</span> is sometimes referred to as the <strong>range</strong>.</p>
<p>We re-fit a spatial linear model and obtain a tidy summary with</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>mod_splm <span class="ot">&lt;-</span> <span class="fu">splm</span>(z <span class="sc">~</span> water <span class="sc">+</span> tarp, <span class="at">data =</span> caribou,</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>                 <span class="at">spcov_type =</span> <span class="st">"exponential"</span>,</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>                 <span class="at">xcoord =</span> <span class="st">"x"</span>, <span class="at">ycoord =</span> <span class="st">"y"</span>)</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>mod_splm <span class="sc">|&gt;</span> <span class="fu">tidy</span>()</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="do">## # A tibble: 4 × 5</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a><span class="do">##   term        estimate std.error statistic  p.value</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a><span class="do">##   &lt;chr&gt;          &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a><span class="do">## 1 (Intercept)   2.05      0.311       6.59 4.33e-11</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a><span class="do">## 2 waterY       -0.0831    0.0645     -1.29 1.98e- 1</span></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a><span class="do">## 3 tarpnone      0.0801    0.0776      1.03 3.02e- 1</span></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a><span class="do">## 4 tarpshade     0.287     0.0767      3.74 1.86e- 4</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>What changes about our interpretation of this summary output compared to the model with independent errors? Next, we will interpret some of the estimated model parameters and find and interpret confidence intervals for some of these parameters.</p>
</section>
<section id="interpreting-the-spatial-linear-model" class="level2" data-number="3.5">
<h2 data-number="3.5" class="anchored" data-anchor-id="interpreting-the-spatial-linear-model"><span class="header-section-number">3.5</span> Interpreting the Spatial Linear Model</h2>
<p>Based on the previous output, our fitted spatial linear model is:</p>
<p><span class="math display">\[
\hat{Y}_i = 2.05 - 0.0831 water_i + 0.0801 tarpnone_i + 0.287 tarpshade_i
\]</span></p>
<p>We can find the estimated spatial covariance parameters with:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tidy</span>(mod_splm, <span class="at">effects =</span> <span class="st">"spcov"</span>)</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="do">## # A tibble: 3 × 3</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="do">##   term  estimate is_known</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="do">##   &lt;chr&gt;    &lt;dbl&gt; &lt;lgl&gt;   </span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a><span class="do">## 1 de      0.111  FALSE   </span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a><span class="do">## 2 ie      0.0226 FALSE   </span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a><span class="do">## 3 range  19.1    FALSE</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Therefore,</p>
<p><span class="math display">\[
\widehat{\text{cov}}(Y_i, Y_j) =
\begin{cases}
0.0226 + 0.111 e^{\frac{-h_{ij}}{19.1}}, &amp; h_{ij} = 0\\
0.111 e^{\frac{-h_{ij}}{19.1}}, &amp; h_{ij} &gt; 0,
\end{cases}
\]</span></p>
<p>where <span class="math inline">\(h_{ij}\)</span> is the distance between locations <span class="math inline">\(i\)</span> and <span class="math inline">\(j\)</span>. Note that, by default, these parameters are estimated using <em>Restricted Maximum Likelihood</em> (REML). The details of the theory behind REML parameter estimation is beyond the scope of these course materials, but we can think about these parameter estimates as providing the best “fit” to the observed data given the specification of the model.</p>
<p>water_i + tarpnone_i + tarpshade_i</p>
<p>We first focus on interpreting <span class="math inline">\(\hat{\beta}_0 = 2.05\)</span>, <span class="math inline">\(\hat{\beta}_1 = -0.0831\)</span>, <span class="math inline">\(\hat{\beta}_2 = 0.0801\)</span>, and <span class="math inline">\(\hat{\beta}_3 = 0.287\)</span>, the estimated regression coefficients in the spatial linear model. These can be interpreted in a similar way to how the fitted regression coefficients are interpreted in a multiple regression model with independent errors. For example, for the <code>waterY</code> coefficient interpretation of <code>-0.0831</code>, we might say something like:</p>
<p>We expect the average percentage of nitrogen for plots with water added to be 0.0831 percentage points lower than the average percentage of nitrogen for plots with no water added, for a fixed value of <code>tarp</code>.</p>
<p>To interpret the three spatial covariance parameters, we can make a covariance plot that has covariance on the y-axis and distance on the x-axis, just as we did in <a href="spatial-covariance.html"><span>Chapter&nbsp;2</span></a>.</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="point-modeling_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>We see from the plot that the model estimates there to be some spatial covariance in the errors of the model for the entire range of distances that are present in the data. We also see that the estimated spatial covariance is slightly higher for locations that are closer together (the smallest non-zero distance in the data is 1 unit) than for locations that are further apart, so, a spatial model seems appropriate.</p>
<section id="inference" class="level3" data-number="3.5.1">
<h3 data-number="3.5.1" class="anchored" data-anchor-id="inference"><span class="header-section-number">3.5.1</span> Inference</h3>
<p>In addition to interpreting the fitted model parameters, we can perform inference (confidence intervals and hypothesis tests) on the slope parameters.</p>
<p>As in a regression model with independent random errors, confidence intervals for the slope parameters (as well as the intercept) can be found with:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tidy</span>(mod_splm, <span class="at">conf.int =</span> <span class="cn">TRUE</span>, <span class="at">conf.level =</span> <span class="fl">0.95</span>)</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="do">## # A tibble: 4 × 7</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="do">##   term        estimate std.error statistic  p.value conf.low conf.high</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="do">##   &lt;chr&gt;          &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a><span class="do">## 1 (Intercept)   2.05      0.311       6.59 4.33e-11   1.44      2.66  </span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a><span class="do">## 2 tarpnone      0.0801    0.0776      1.03 3.02e- 1  -0.0720    0.232 </span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a><span class="do">## 3 tarpshade     0.287     0.0767      3.74 1.86e- 4   0.136     0.437 </span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a><span class="do">## 4 waterY       -0.0831    0.0645     -1.29 1.98e- 1  -0.209     0.0433</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>And, these intervals can be interpreted in the same way. For example, to interpret the 95% confidence interval for <span class="math inline">\(\beta_2\)</span>, the slope coefficient for <code>tarpshade</code>, we might say something like:</p>
<p>We are 95% confidence that the average nitrogen percentage for plots with a shade tarp cover is between 0.136 percentage points and 0.437 percentage points higher than the average nitrogen percentage for plots with a clear tarp cover, for a fixed value of <code>water</code>.</p>
<p>We can also make similar interpretations about p-values for hypothesis tests from the fitted model output. For example, the p-value in the <code>tarpshade</code> row tests the hypothesis:</p>
<p><span class="math inline">\(H_0: \beta_2 = 0\)</span> vs.</p>
<p><span class="math inline">\(H_a: \beta_2 \neq 0\)</span></p>
<p>With a small p-value of 0.00019, we have strong evidence that the average nitrogen percentage for plots with the shade tarp is different than the average nitrogen percentage for plots with the <code>clear</code> tarp (the reference group), after accounting for the effects of <code>water</code>.</p>
<p>Note however, that the p-values in these hypothesis tests and the confidence intervals for the slope coefficients are <em>asymptotic</em>, meaning that they are only technically valid for very large sample sizes. They should be viewed as only approximate for small sample sizes. Because the <code>caribou</code> data only has 30 observations, the confidence intervals and p-values are only approximations and should be taken with a small grain of salt.</p>
<p>Also note that it is a common misconception that incorporating spatial dependence into the random errors of a model will always result in larger p-values. While this is true for some data sets, it is certainly not always the case. Sometimes, accounting for spatial correlation strengthens the “signal” from the predictors in the model, resulting in smaller p-values for tests of association between predictors and the response, as we see for each of the predictors in the <code>caribou</code> example.</p>
</section>
</section>
<section id="sec-compare" class="level2" data-number="3.6">
<h2 data-number="3.6" class="anchored" data-anchor-id="sec-compare"><span class="header-section-number">3.6</span> Comparing Models</h2>
<p>Now that we have discussed how to interpret the model parameters in a spatial linear model and how to conduct inference on some of these parameters, we will try to answer the question “is the spatial model a better fit to the data than the independent error model?” Or, put another way, is it necessary to fit a spatial model for this particular data set?</p>
<p>We will approach this question in two ways: we will make a visualization of the model residuals from the independent error model and we will compare the two models directly with a model fit criterion.</p>
<p>First, if a model with independent random errors is sufficient, then we would expect there to be evidence of spatial correlation in the random errors of that model. But, we never actually observe realizations of the random errors. We do, however, observe <strong>residuals</strong> for a model. Recall that a <strong>residual</strong> for the <span class="math inline">\(i^{th}\)</span> observation is defined as:</p>
<p><span class="math display">\[
e_i = y_i - \hat{y}_i,
\]</span></p>
<p>where <span class="math inline">\(y_i\)</span> is the observed response value for the <span class="math inline">\(i^{th}\)</span> observation and <span class="math inline">\(\hat{y}_i\)</span> is the predicted response value for the <span class="math inline">\(i^{th}\)</span> observation based on the predictor values associated with <span class="math inline">\(y_i\)</span> and the estimated regression coefficients <span class="math inline">\(\hat{\beta}_0, \hat{\beta}_1, \ldots\)</span>. In the caribou example, for the independent error model,</p>
<p><span class="math display">\[
\hat{y}_i = 1.96 - 0.0352 water_i + 0.0497 tarpnone_i + 0.251 tarpshade_i.
\]</span></p>
<p>If the independent error model is sufficient, then, if we make a plot of the model residuals, we would expect to see very little evidence of spatial correlation.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>caribou_r <span class="ot">&lt;-</span> caribou <span class="sc">|&gt;</span> <span class="fu">mutate</span>(<span class="at">.resid =</span> <span class="fu">residuals</span>(mod_lm))</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> caribou_r, <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y,</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>                             <span class="at">colour =</span> .resid)) <span class="sc">+</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_colour_viridis_c</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">0.5</span>, <span class="fl">0.5</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="point-modeling_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>From this plot, we “kind of” see evidence of spatial correlation in the residuals: the points in the upper-left do seem like they have generally higher residuals than the points in the bottom-right. But, with only 30 data points, making this subjective assessment is extremely tough.</p>
<p>An alternative approach is to compare the models more formally using model fit criteria like AIC or AICc. We do not define these explicitly here, but recall that lower AIC and AICc values are generally better. Intuitively, both of these criteria provide a balance between model fit and the number of parameters needed to fit the model. So, if two models provide roughly equal “fit,” the model with fewer parameters will have the lower (and better) AIC and AICc values.</p>
<p>We can also use these model fit criteria to assess the fit of a couple of other covariance functions, like the <code>"gaussian"</code> and the <code>"spherical"</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>many_mods <span class="ot">&lt;-</span> <span class="fu">splm</span>(z <span class="sc">~</span> water <span class="sc">+</span> tarp, <span class="at">data =</span> caribou,</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>                 <span class="at">xcoord =</span> x, <span class="at">ycoord =</span> y,</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>                 <span class="at">spcov_type =</span> <span class="fu">c</span>(<span class="st">"none"</span>, <span class="st">"exponential"</span>, <span class="st">"spherical"</span>, <span class="st">"gaussian"</span>))</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a><span class="fu">glances</span>(many_mods)</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a><span class="do">## # A tibble: 4 × 11</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a><span class="do">##   model           n     p  npar value   AIC  AICc   BIC logLik deviance</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a><span class="do">##   &lt;chr&gt;       &lt;int&gt; &lt;dbl&gt; &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;    &lt;dbl&gt;</span></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a><span class="do">## 1 none           30     4     1 -1.68 0.323 0.466  1.72  0.838     26  </span></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a><span class="do">## 2 exponential    30     4     3 -5.85 0.150 1.07   4.35  2.92      26.0</span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a><span class="do">## 3 spherical      30     4     3 -5.84 0.155 1.08   4.36  2.92      26.0</span></span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a><span class="do">## 4 gaussian       30     4     3 -5.69 0.314 1.24   4.52  2.84      26.0</span></span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a><span class="do">## # ℹ 1 more variable: pseudo.r.squared &lt;dbl&gt;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>In the code above, <code>spcov_type</code> is a vector of possible covariance functions. Each different covariance function is fit as a model for the errors. Setting <code>spcov_type</code> to <code>"none"</code> tells <code>splm()</code> to not use any spatial covariance and to just fit a regression model with independent random errors. we then use <code>glances()</code> to compare AIC for the fitted models. We see that, while the exponential model has a slightly lower AIC than the others, an independent error model fits almost as well and actually has a lower AICc value.</p>
<p>In this section, we have fit and interpreted a formal spatial model using a data set on caribou as our example. In the next section, we turn our attention to the assumptions we need to make to fit such a model.</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./spatial-covariance.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Spatial Covariance and Correlation</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./model-assumptions.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Model Assumptions</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">Materials for use in conjunction with the <code>spmodel</code> R package.</div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">This book was built with <a href="https://quarto.org/">Quarto</a>.</div>
  </div>
</footer>



</body></html>